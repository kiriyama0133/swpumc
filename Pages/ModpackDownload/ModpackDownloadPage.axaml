<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sukiUi="clr-namespace:SukiUI.Controls;assembly=SukiUI"
             xmlns:material="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="swpumc.Pages.ModpackDownload.ModpackDownloadPage">
    
    <sukiUi:BusyArea IsBusy="{Binding IsLoading}" BusyText="处理整合包...">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
        
        <!-- 页面标题 -->
        <sukiUi:GlassCard Grid.Row="0" 
                          CornerRadius="15" 
                          Padding="20"
                          Margin="0,0,0,20">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="15">
                    <material:MaterialIcon Kind="Archive"
                                          Width="32" 
                                          Height="32"
                                          Foreground="{DynamicResource SukiPrimaryColor}"
                                          VerticalAlignment="Center"/>
                    <StackPanel>
                        <TextBlock Text="整合包下载" 
                                   FontSize="24" 
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource SukiText}"/>
                        <TextBlock Text="选择并安装整合包文件" 
                                   FontSize="14"
                                   Foreground="{DynamicResource SukiLowText}"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </sukiUi:GlassCard>
        
        <!-- 主要内容区域 -->
        <sukiUi:GlassCard Grid.Row="1" 
                          CornerRadius="15" 
                          Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 文件选择区域 -->
                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                    <TextBlock Text="选择整合包文件" 
                               FontSize="18" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource SukiText}"
                               Margin="0,0,0,15"/>
                    
                    <!-- 文件选择按钮和路径显示 -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 文件路径显示 -->
                        <Border Grid.Column="0" 
                                Background="{DynamicResource SukiCardBackground}"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="已选择的文件:" 
                                           FontSize="12"
                                           Foreground="{DynamicResource SukiLowText}"
                                           Margin="0,0,0,5"/>
                                <TextBlock Text="{Binding SelectedFilePath, FallbackValue='请选择整合包文件 (.zip 或 .mrpack)'}" 
                                           FontSize="14"
                                           Foreground="{DynamicResource SukiText}"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- 选择文件按钮 -->
                        <Button Grid.Column="1" 
                                Classes="Standard Primary"
                                Command="{Binding SelectFileCommand}"
                                Padding="20,15">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <material:MaterialIcon Kind="FolderOpen"
                                                          Width="16" 
                                                          Height="16"/>
                                    <TextBlock Text="选择文件" 
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                    </Grid>
                </StackPanel>
                
                <!-- 整合包信息区域 -->
                <StackPanel Grid.Row="1" Margin="0,0,0,20" IsVisible="{Binding HasSelectedFile}">
                    <TextBlock Text="整合包信息" 
                               FontSize="18" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource SukiText}"
                               Margin="0,0,0,15"/>
                    
                    <sukiUi:GlassCard CornerRadius="10" Padding="15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- 整合包类型图标 -->
                            <material:MaterialIcon Grid.Column="0"
                                                  Kind="{Binding ModpackTypeIcon}"
                                                  Width="24" 
                                                  Height="24"
                                                  Foreground="{Binding ModpackTypeColor}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,15,0"/>
                            
                            <!-- 整合包信息 -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding ModpackTypeName}" 
                                           FontSize="16" 
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource SukiText}"
                                           Margin="0,0,0,5"/>
                                <TextBlock Text="{Binding ModpackValidationMessage}" 
                                           FontSize="14"
                                           Foreground="{DynamicResource SukiLowText}"/>
                            </StackPanel>
                        </Grid>
                    </sukiUi:GlassCard>
                </StackPanel>
                
                <!-- 操作按钮区域 -->
                <StackPanel Grid.Row="2" 
                            VerticalAlignment="Bottom"
                            IsVisible="{Binding HasSelectedFile}">
                    <StackPanel Orientation="Horizontal" Spacing="15" HorizontalAlignment="Center">
                        <!-- 验证按钮 -->
                        <Button Classes="Standard" 
                                Command="{Binding ValidateModpackCommand}"
                                IsEnabled="{Binding !IsValidating}"
                                Padding="20,12">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <material:MaterialIcon Kind="CheckCircle"
                                                          Width="16" 
                                                          Height="16"/>
                                    <TextBlock Text="验证整合包" 
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                        
                        <!-- 安装按钮 -->
                        <Button Classes="Standard Primary" 
                                Command="{Binding InstallModpackCommand}"
                                IsEnabled="{Binding CanInstall}"
                                Padding="20,12">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <material:MaterialIcon Kind="Download"
                                                          Width="16" 
                                                          Height="16"/>
                                    <TextBlock Text="安装整合包" 
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                    </StackPanel>
                    
                    <!-- 进度显示 -->
                    <StackPanel IsVisible="{Binding IsInstalling}" 
                                Margin="0,20,0,0">
                        <TextBlock Text="{Binding InstallProgressText}" 
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource SukiText}"
                                   FontSize="14"
                                   Margin="0,0,0,10"/>
                        <ProgressBar Value="{Binding InstallProgress}" 
                                     Maximum="100"
                                     Height="8"
                                     CornerRadius="4"
                                     Background="{DynamicResource SukiCardBackground}"
                                     Foreground="{DynamicResource SukiPrimaryColor}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </sukiUi:GlassCard>
        </Grid>
    </sukiUi:BusyArea>
</UserControl>
